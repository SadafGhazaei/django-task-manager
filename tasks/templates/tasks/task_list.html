{% extends 'base.html' %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h1>All Tasks</h1>
    <a href="{% url 'task-create' %}" class="btn btn-primary">+ Add New Task</a>
</div>

<form method="get" class="mb-4">
    <div class="input-group">
        <input type="text" name="search" class="form-control" placeholder="Search in titles and descriptions..."
            value="{{ request.GET.search }}">
        <button class="btn btn-outline-secondary" type="submit">üîç Search</button>
        {% if request.GET.search %}
        <a href="{% url 'task-list' %}" class="btn btn-outline-danger">Clear</a>
        {% endif %}
    </div>
</form>

{% if tasks %}
<div class="table-responsive">
    <table class="table table-striped table-hover">
        <thead class="table-dark">
            <tr>
                <th>Title</th>
                <th>Status</th>
                <th>Priority</th>
                <th>Description</th>
                <th>Created By</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
            {% for task in tasks %}
            <tr>
                <td><strong>{{ task.title }}</strong></td>
                <td>
                    <span class="badge 
                            {% if task.status == 'todo' %}bg-secondary
                            {% elif task.status == 'in_progress' %}bg-warning
                            {% else %}bg-success{% endif %}">
                        {{ task.get_status_display }}
                    </span>
                </td>
                <td>
                    <span class="badge 
                            {% if task.priority == 'low' %}bg-info
                            {% elif task.priority == 'medium' %}bg-warning
                            {% elif task.priority == 'high' %}bg-danger
                            {% else %}bg-secondary{% endif %}">
                        {{ task.get_priority_display|default:"Not Set" }}
                    </span>
                </td>
                <td>{{ task.description|truncatewords:10 }}</td>
                <td>
                    {% if task.created_by == user %}
                    <span class="text-primary">You</span>
                    {% else %}
                    {{ task.created_by.username }}
                    {% endif %}
                </td>
                <td>
                    <a href="{% url 'task-detail' task.id %}" class="btn btn-sm btn-info">View</a>
                    {% if task.created_by == user %}
                    <a href="{% url 'task-update' task.id %}" class="btn btn-sm btn-warning">Edit</a>
                    <a href="{% url 'task-delete' task.id %}" class="btn btn-sm btn-danger">Delete</a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<div class="alert alert-info text-center">
    {% if request.GET.search %}
    No tasks found matching your search.
    {% else %}
    No tasks available. <a href="{% url 'task-create' %}">Create the first task!</a>
    {% endif %}
</div>
{% endif %}
{% endblock %}